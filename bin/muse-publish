#!/bin/bash
# example: muse agl-html/pdf hello.muse
. ham-toolset emacs > /dev/null

style=$(echo $1 | sed 's/^--//')
export EMACS_BATCHMODE=1
SRC_FULLPATH=${2}
SRC_DIR=`dirname ${SRC_FULLPATH}`
SRC_FILENAME=`basename ${SRC_FULLPATH}`
cd ${SRC_DIR}
$EMACS_EXE -batch -no-site-file -q \
    -l "${HAM_HOME}/sources/emacs/site/ni-base.el" \
    -l "${HAM_HOME}/sources/emacs/ham-shell.el" \
    -l "${HAM_HOME}/sources/emacs/ham-setup.el" \
    -l "${HAM_HOME}/sources/emacs/site/ni-muse.el" \
    -l muse-regexps.el -l muse.el -l muse-publish.el \
    -l muse-html.el -l muse-latex.el -l muse-texinfo.el \
    -f muse-batch-publish-files $style --output-dir=. ${SRC_FILENAME}
